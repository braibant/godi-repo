# This file was automatically generated by godiva version 0.9.7
.include "../../mk/bsd.prefs.mk"

PKG  =          godi-batteries
PKGNAME=        ${PKG}-${VERSION}
VERSION = 	2.3
PKGREVISION=    0
CATEGORIES=     godi
FORGE_NODE =	1465
MASTER_SITES=   http://forge.ocamlcore.org/frs/download.php/${FORGE_NODE}/
MAINTAINER=	wodi@ml.ignorelist.com
HOMEPAGE=       http://batteries.forge.ocamlcore.org
COMMENT=	a community-maintained foundation library for OCaml
GIT_REPO=	git://github.com/ocaml-batteries-team/batteries-included.git
DISTNAME = 	batteries-${VERSION}
DISTFILES = 	batteries-${VERSION}.tar.gz

GODI_BATTERIES_GIT_REPO ?= ${GIT_REPO}
GODI_BATTERIES_GIT_BRANCH ?= master

GODI_BATTERIES_VCS_CHECKOUT ?= no
GODI_BATTERIES_RUN_TESTS ?= no

#.if defined(OPSYS) && ${OPSYS} == "CYGWIN" && defined(W32PORT) && ${W32PORT} == "mingw"
# because of symlinks
#GODI_BATTERIES_BUILD_DOCS = no
#.else
GODI_BATTERIES_BUILD_DOCS ?= yes
#.endif

.if ${GODI_BATTERIES_VCS_CHECKOUT} == "yes"
DISTNAME = batteries-included
DISTFILES =
PKGREVISION = 99
.endif

AUTOGENERATE_PLIST = yes
MAKE_FLAGS=     PREFIX=${PREFIX} LIBDIR=${PREFIX}/lib BINDIR=${PREFIX}/bin MANDIR=${PREFIX}/man DOCROOT=${PREFIX}/doc/${PKG}
DEPENDS+= godi-ocaml>4.00.1:../../godi/godi-ocaml
DEPENDS+= godi-bytes>1.5:../../godi/godi-bytes
BUILD_DEPENDS+= godi-findlib>=1.2.5:../../godi/godi-findlib
.if ${GODI_BATTERIES_RUN_TESTS} == "yes"
BUILD_DEPENDS+= godi-ounit>=1.0.3:../../godi/godi-ounit
BUILD_DEPENDS+= godi-qtest>=2.0:../../godi/godi-qtest
BUILD_DEPENDS+= godi-bisect>=1.3:../../godi/godi-bisect
.endif

.if !defined(SHLIB_TYPE) || ${SHLIB_TYPE} == "MachO"
GODI_BATTERIES_SHLIB ?= no
.else
GODI_BATTERIES_SHLIB ?= yes
.endif

.if ${GODI_BATTERIES_SHLIB} != "yes"
MAKE_ENV += BATTERIES_NATIVE_SHLIB=no
.endif

GODI_BATTERIES_BROWSER_COMMAND ?= x-www-browser
MAKE_ENV += BROWSER_COMMAND="${GODI_BATTERIES_BROWSER_COMMAND}"

.if ${GODI_HAVE_OCAMLOPT} != "yes"
MAKE_ENV += BATTERIES_NATIVE=no
.endif

#HAS_CONFIGURE = yes

USE_GMAKE = yes

MAKE_ENV+=  ${BUILD_OCAMLFIND_ENV} PKGBASE=${PKGBASE:Q}

post-extract:
.if ${GODI_BATTERIES_VCS_CHECKOUT} == "yes"
	@echo "===> Checking out Batteries from Git"
	cd ${WRKDIR} && git clone -b ${GODI_BATTERIES_GIT_BRANCH} ${GODI_BATTERIES_GIT_REPO}
.endif

.if ${GODI_BATTERIES_VCS_CHECKOUT} == "yes"
patch: extract
	@echo "===> Patches disabled for VCS checkout"
.endif

.if defined(W32PORT) && ${W32PORT} == "mingw"
BUILD_DEPENDS+= apps-oasis>0.3.0:../../apps/apps-oasis
pre-configure:
	@cd ${WRKSRC} && ${SETENV} ${CONFIGURE_ENV} oasis setup
.endif



ALL_TARGET=     all
INSTALL_TARGET = install

.if ${GODI_BATTERIES_RUN_TESTS} == "yes"
ALL_TARGET += test 
.if ${GODI_HAVE_OCAMLOPT} != "no"
ALL_TARGET += test-native
.endif
.endif

.if ${GODI_BATTERIES_BUILD_DOCS} == "yes"
ALL_TARGET += doc
INSTALL_TARGET += install-doc
.endif

post-install:

.include "../../mk/bsd.pkg.mk"
